# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

AI-Galaxy is a self-expanding, agent-driven microservice civilization designed as a structured and self-organizing AI system. The project combines semantic search, autonomous agents, and hierarchical data structures to create a digital ecosystem where ideas evolve into microservices through collaboration between meta-layers and domain-specific entities.

## Architecture

The system operates on a hierarchical structure with multiple layers:

**HIGHER-META-LAYER**
- Decides which departments should exist
- Initiates new ideas when semantic search is lacking

**LOWER-META-LAYER** (core/agents/)
- `council_agent.py`: Evaluates idea proposals and decides what moves forward
- `creator_agent.py`: Creates templates from approved ideas  
- `implementer_agent.py`: Manages idea realization progress
- `programmer_agent.py`: Writes actual code implementation
- `router_agent.py`: Routes ideas to correct departments/institutions
- `registrar_agent.py`: Registers and archives completed microservices

**DEPARTMENTS** (departments/)
- Main functional areas (e.g., machine learning, NLP, image processing)
- Can be `active` (building services) or `inactive` (owning code resources)
- Each has a `manifest.yaml` with metadata

**INSTITUTIONS** (institutions/)
- Specialized sectors under departments (e.g., Keras, Vision Transformers)
- Create microservices within their specific domain
- Contains `/services/` subdirectory for generated microservices

**MICROSERVICES** (microservices/)
- Final output: independent, functional services generated by institutions

## Core Services

**Redis** (services/redis/db.py)
- Shared state and data persistence

**Vector Search** (services/vector_search/query_service.py)  
- Semantic search engine for resource discovery

**Meta Planner** (services/meta_planner/new_department_generator.py)
- Detects structural gaps and suggests new departments

## Idea Processing Flow

1. Ideas created in `idea_factory`
2. Validation through `validator → council`
3. Approved ideas processed by `creator → implementer → programmer`
4. Router directs to appropriate department/institution
5. Missing resources trigger `meta_planner` → new department creation

## State Machine

The system uses `config/state_machine.yaml` to define idea processing flows, with routing logic in `core/state_machine/router.py`.

## Development Commands

**Running the System:**
```bash
python main.py --config config.yaml --verbose
```

**Installing Dependencies:**
```bash
pip install -r requirements.txt
```

**Testing:**
```bash
pytest  # Run all tests
pytest tests/test_router.py  # Run specific test file
```

**Code Formatting:**
```bash
black ai_galaxy/  # Format code
isort ai_galaxy/  # Sort imports
```

## Development Context

This is a functional Python project with implemented agents and services. Key implementation details:

- All agents are implemented in `core/agents/` with actual functionality
- Services (Redis, Vector Search, Meta Planner) are operational
- State machine workflows are defined in `config/state_machine.yaml`
- Main application entry point is `main.py` with full orchestration
- System uses async/await patterns throughout for concurrent processing

## System Configuration

**Main Config:** `config.yaml` contains:
- Redis connection settings (localhost:6379)
- Vector search configuration (ChromaDB)
- System orchestrator settings
- API server configuration (port 8080)
- Logging and monitoring settings

**State Machine:** `ai_galaxy/config/state_machine.yaml` defines:
- Idea processing workflow states (created → validated → council_review → approved → etc.)
- Agent assignments for each transition
- Retry policies and error handling
- Routing rules and monitoring metrics

## Key Services

**System Orchestrator:** (`orchestrator.py`)
- Central coordination hub for all agents and services
- Manages agent lifecycle and task distribution
- Provides system metrics and health monitoring

**Vector Search:** Uses ChromaDB for semantic search and embeddings

**Redis:** Shared state management and caching layer

## MCP Integration

The project uses Context7 MCP server for retrieving up-to-date documentation and code examples from external libraries.

# **USE CONTEXT7 MCP TOOL TO FETCH UPDATED DOCUMENTATION, SO THE CODE WON'T BE OUTDATED**

## Shared Components

**Models** (shared/models.py)
- Data structures for Idea, Department, Institution entities

**Logging** (shared/logger.py) 
- Standardized logging across all components

**Testing** (tests/)
- Focus on testing routing logic and state machine flows
- Uses pytest with asyncio support for testing async components